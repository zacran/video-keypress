(this["webpackJsonpvideo-keypress"]=this["webpackJsonpvideo-keypress"]||[]).push([[0],{107:function(e,t,a){"use strict";a.r(t);var n=a(2),i=a(0),c=a(8),o=a.n(c),r=a(26),s=a(12),l=(a(57),a(84),a(5)),d=a(153),u=a(155),b=a(148),j=a(149),v=a(150),p=a(38),h=a(71),g=a(62),O=a(48),m=a(145),x=a(108),y=a(143),f=.1;function k(e){return 1e3*e}function S(e){return"".concat(e.toFixed(2),"ms")}var R=Object(y.a)((function(e){return{root:{flexGrow:1,margin:"auto",maxWidth:"600px"},paper:{padding:e.spacing(1),fontSize:"12px",textAlign:"center",color:e.palette.text.secondary},control:{padding:e.spacing(2)}}})),N=function(e){var t,a=Object(i.useState)([]),c=Object(r.a)(a,2),o=c[0],s=c[1],l=Object(i.useState)([]),d=Object(r.a)(l,2),u=d[0],b=d[1],j=Object(i.useState)(0),v=Object(r.a)(j,2),y=v[0],N=v[1],w=R();return Object(i.useEffect)((function(){var t=setInterval((function(){o.length!==y&&(N(o.length),function(){var t=o.filter((function(e){return"string"===typeof e[0]&&"Meta"!==e[1]}));console.log(o);var a=[];t.forEach((function(e){-1===a.indexOf(e[0])&&a.push(e[0])}));var n=[];a.forEach((function(e){var a=0,i=0,c=t.filter((function(t){return t[0]===e}));console.log("finding derived fields for "+e+" found "+c.length+" events"),a=c.length,c.map((function(e){i+=e[3]-e[2]}));var o={behavior:e,occurences:a,totalDuration:i,avgDuration:i/a};n.push(o)})),b((function(e){return e=n,console.log(e),e})),e.state.derivedFields=u}())}),500);return function(){return clearInterval(t)}})),Object(i.useEffect)((function(){var t=""!==e.state.videoFilePath,a=0===o.length&&e.state.data.events&&0===e.state.data.events.length;if(t||0===o.length||(s([]),b([])),t&&a){var n=[[{type:"string",id:"Behavior"},{type:"string",id:"Event"},{type:"number",id:"Start"},{type:"number",id:"End"}],["Behavior","Meta",0,k(e.state.data.metadata.duration)]];s(n)}var i=e.state.data.events&&e.state.data.events.length>0,c=e.state.data.events.length+2>o.length;if(i&&c){var r=e.state.data.events[e.state.data.events.length-1];r.end-r.start<f&&(r.end+=f);e.state.data.events.find((function(e){e.id!==r.id&&(e.start===r.start&&(console.warn("Adjusted event start time due to existing similar events: "+r.id),r.start+=.11000000000000001),e.behavior===r.behavior&&e.end===r.start&&(console.warn("Adjusted event start time due to existing similar events: "+r.id),r.start+=.010000000000000002),e.end===r.end&&(console.warn("Adjusted event end time due to existing similar events: "+r.id),r.end+=.11000000000000001))}));var l=[r.behavior,"Event: #"+r.id,k(r.start),k(r.end)];s((function(e){return[].concat(Object(h.a)(e),[l])}))}})),Object(n.jsxs)("div",{className:"Row",children:[u.length>0?u.map((function(e){return Object(n.jsxs)(m.a,{container:!0,className:w.root,spacing:2,children:[Object(n.jsx)(m.a,{item:!0,xs:3,children:Object(n.jsxs)(x.a,{className:w.paper,children:[Object(n.jsx)(O.a,{variant:"caption",display:"inline",gutterBottom:!0,children:"    Behavior:   "}),Object(n.jsx)(O.a,{variant:"subtitle2",display:"block",align:"center",gutterBottom:!0,children:e.behavior})]})}),Object(n.jsx)(m.a,{item:!0,xs:3,children:Object(n.jsxs)(x.a,{className:w.paper,children:[Object(n.jsx)(O.a,{variant:"caption",display:"inline",gutterBottom:!0,children:"    Occurences: "}),Object(n.jsx)(O.a,{variant:"subtitle2",display:"block",align:"center",gutterBottom:!0,children:e.occurences})]})}),Object(n.jsx)(m.a,{item:!0,xs:3,children:Object(n.jsxs)(x.a,{className:w.paper,children:[Object(n.jsx)(O.a,{variant:"caption",display:"inline",gutterBottom:!0,children:"    Avg Duration:   "}),Object(n.jsx)(O.a,{variant:"subtitle2",display:"block",align:"center",gutterBottom:!0,children:S(e.avgDuration)})]})}),Object(n.jsx)(m.a,{item:!0,xs:3,children:Object(n.jsxs)(x.a,{className:w.paper,children:[Object(n.jsx)(O.a,{variant:"caption",display:"inline",gutterBottom:!0,children:"    Total Duration:    "}),Object(n.jsx)(O.a,{variant:"subtitle2",display:"block",align:"center",gutterBottom:!0,children:S(e.totalDuration)})]})})]},e.behavior)})):"",Object(n.jsx)("div",{className:"GoogleChart",children:o.length>1?Object(n.jsx)(g.a,(t={width:"840px",height:"100%",chartType:"Timeline",data:o,options:{timeline:{colorByRowLabel:!0,margin:"auto"}}},Object(p.a)(t,"options",{timeline:{showBarLabels:!1,colorByRowLabel:!0},colors:["transparent","#469FAE","#3ECDB6","#F7D9A6","#F67E5C","#CA1252","#DD5B5C","#D9959A","#938D99","#5E614A"]}),Object(p.a)(t,"rootProps",{"data-testid":"6"}),t)):""})]})},w=a(70),B=a.n(w),F=a(65),P=a.n(F),E=a(52),D={Keybinds:[{key:"g",code:"71",color:{r:"241",g:"112",b:"19",a:"1"},behavior:"Grooming",active:!1},{key:"s",code:"83",color:{r:"41",g:"112",b:"200",a:"1"},behavior:"Scratching",active:!1}]},C=a(53),A=a.n(C),I=a(67),L=a.n(I),M=a(68),T=a.n(M),V=a(69),z=a.n(V),G=a(151),U=a(157),J=a(152),K=a(156),H=["32"," "],W=Object(y.a)((function(e){return{popoverMenu:{width:"200px"},slider:{margin:"0px 20px",width:"80%"},button:{padding:0},smallButton:{marginTop:-4,padding:4,"& svg":{fontSize:18}},largeButton:{display:"block",margin:"auto","& svg":{fontSize:144,color:"#469FAE"}},toolbar:{minHeight:48,maxHeight:48},title:{flexGrow:1},menu:{width:"fit-content",border:"1px solid ".concat(e.palette.divider),borderRadius:e.shape.borderRadius,"& svg":{margin:e.spacing(1.5)},"& hr":{margin:e.spacing(0,.5)}}}})),q=Object(l.a)({paper:{border:"1px solid #d3d4d5",width:"200px",margin:"0px 10px"}})((function(e){return Object(n.jsx)(d.a,Object(s.a)({elevation:0,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"}},e))})),Q=Object(l.a)((function(e){return{root:{"&:focus":{backgroundColor:e.palette.primary.main,"& .MuiListItemIcon-root, & .MuiListItemText-primary":{color:e.palette.common.white}}}}}))(u.a);var X=function(){var e=!1,t=Object(i.useState)({videoFilePath:"",isPlaying:!1,duration:0,playedSeconds:0,loadedSeconds:0,playbackRate:1,keybinds:D.Keybinds,data:{metadata:{},events:[]},activeRecords:[],derivedFields:[]}),a=Object(r.a)(t,2),c=a[0],o=a[1];var l=function(){o(Object(s.a)(Object(s.a)({},c),{},{isPlaying:!0}))},d=function(){o(Object(s.a)(Object(s.a)({},c),{},{isPlaying:!1}))},u=function(e,t){console.log("press "+e,c),c.keybinds.forEach((function(a){a.key!==String(e)&&a.code!==String(e)||t(a)}))},p=function(e){if(!e.active){e.active=!0,console.log("key down: "+e.key+" at "+c.playedSeconds+" secs");var t={key:e.key,behavior:e.behavior,start:c.playedSeconds},a=c.activeRecords;a.push(t),o(Object(s.a)(Object(s.a)({},c),{},{activeRecords:a})),console.log("recorded activity start: ",t),console.log(c.activeRecords)}},h=function(e){var t=c.activeRecords.find((function(t){return t.key===e.key})),a=c.activeRecords.filter((function(t){return t.key!==e.key}));if(t){e.active=!1,console.log("key up: "+e.key+" at "+c.playedSeconds+" secs"),t.id=c.data.events.length,t.end=c.playedSeconds,console.log("recorded activity end: ",t),console.log(c.activeRecords);var n=c.data.events;n.push(t),o(Object(s.a)(Object(s.a)({},c),{},{activeRecords:a,data:{events:n,metadata:Object(s.a)({},c.data.metadata)}})),console.log(c.data)}};Object(E.a)("keydown",(function(t){""!==c.videoFilePath&&H.includes(String(t.key))?(console.log("space "+t.key,c),t.preventDefault(),e=!e):c.isPlaying&&u(t.key,p)})),Object(E.a)("keyup",(function(e){var t=e.key;u(t,h)}));var g=W(),x=Object(i.useRef)(null),y=(Object(i.useRef)(null),Object(i.useState)(null)),f=Object(r.a)(y,2),k=f[0],S=f[1],R=Object(i.useState)(null),w=Object(r.a)(R,2),F=w[0],C=w[1];return Object(n.jsxs)("div",{className:"App",children:[Object(n.jsx)("input",{type:"file",ref:x,onChange:function(e){var t=e.target.files[0];if(t){var a=document.createElement("video"),n=URL.createObjectURL(t);a.src=n,a.addEventListener("loadedmetadata",(function(){var t=parseFloat(a.duration.toFixed(2));o(Object(s.a)(Object(s.a)({},c),{},{videoFilePath:n,videoFileName:e.target.files[0].name,data:{metadata:{fileName:e.target.files[0].name,scoringDate:Date.now(),scoringDateText:(new Date).toISOString(),duration:t},events:[]}})),document.activeElement.blur()}))}},style:{display:"none"}}),Object(n.jsxs)(q,{className:g.popoverMenu,anchorEl:F,keepMounted:!0,open:Boolean(F),onClose:function(){C(null)},children:[Object(n.jsx)(b.a,{id:"playbackRate-slider",primary:"Playback Speed",align:"center"}),Object(n.jsx)(K.a,{className:g.slider,value:c.playbackRate||1,getAriaValueText:function(e){return"".concat(e,"x")},"aria-labelledby":"playbackRate-slider",step:.25,marks:!0,min:.25,max:2,valueLabelDisplay:"auto",onChange:function(e,t){t!=c.playbackRate&&o(Object(s.a)(Object(s.a)({},c),{},{playbackRate:parseFloat(t)}))}},"playbackRate-slider")]}),Object(n.jsxs)(q,{className:g.popoverMenu,anchorEl:k,keepMounted:!0,open:Boolean(k),onClose:function(){S(null)},children:[Object(n.jsxs)(Q,{children:[!1===c.isPlaying&&0===c.playedSeconds&&Object(n.jsx)(b.a,{primary:"Start",secondary:"space",align:"center"}),!0===c.isPlaying&&Object(n.jsx)(b.a,{primary:"Pause",secondary:"space",align:"center"}),!1===c.isPlaying&&c.playedSeconds>0&&Object(n.jsx)(b.a,{primary:"Resume",secondary:"space",align:"center"})]}),c.keybinds.map((function(e){return Object(n.jsx)(Q,{children:Object(n.jsx)(b.a,{primary:e.behavior,secondary:e.key,align:"center"})},e.key)}))]}),Object(n.jsx)(j.a,{position:"static",style:{background:"#469FAE"},children:Object(n.jsxs)(v.a,{className:g.toolbar,children:[Object(n.jsx)(O.a,{variant:"h5",component:"h1",className:g.title,children:"Behavior Recorder"}),Object(n.jsxs)(m.a,{container:!0,alignItems:"center",className:g.menu,children:[Object(n.jsx)(U.a,{title:"Select Video",children:Object(n.jsx)(G.a,{"aria-label":"select video",color:"inherit",className:g.button,onClick:function(e){return x.current.click()},children:Object(n.jsx)(A.a,{})})}),Object(n.jsx)(J.a,{orientation:"vertical",flexItem:!0}),Object(n.jsx)(U.a,{title:"Download Data",children:Object(n.jsx)(G.a,{"aria-label":"download data",color:"inherit",className:g.button,onClick:function(){if(c.data.events&&c.data.events.length>0){var e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(c.data)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",c.videoFileName+"-scored-behavior.json"),document.body.appendChild(t),t.click(),t.remove()}},children:Object(n.jsx)(L.a,{})})}),Object(n.jsx)(J.a,{orientation:"vertical",flexItem:!0}),Object(n.jsx)(U.a,{title:"Keybinds",children:Object(n.jsx)(G.a,{"aria-label":"keybinds",color:"inherit","aria-haspopup":"true",onClick:function(e){S(e.currentTarget)},className:g.button,children:Object(n.jsx)(T.a,{})})}),Object(n.jsx)(J.a,{orientation:"vertical",flexItem:!0}),Object(n.jsx)(U.a,{title:"Settings",children:Object(n.jsx)(G.a,{"aria-label":"settings",color:"inherit","aria-haspopup":"true",onClick:function(e){C(e.currentTarget)},className:g.button,children:Object(n.jsx)(z.a,{})})})]})]})}),c.videoFilePath?Object(n.jsxs)(O.a,{variant:"button",display:"block",align:"center",gutterBottom:!0,children:["Current Video: ",c.videoFileName,Object(n.jsx)(U.a,{title:"Unset Video",children:Object(n.jsx)(G.a,{"aria-label":"unset video",color:"inherit",className:g.smallButton,onClick:function(){x.current.value="",o(Object(s.a)(Object(s.a)({},c),{},{videoFilePath:"",videoFileName:"",data:{metadata:{},events:[]}}))},children:Object(n.jsx)(B.a,{})})})]}):"",c.videoFilePath?"":Object(n.jsxs)("div",{children:[Object(n.jsx)(O.a,{variant:"button",display:"block",align:"center",gutterBottom:!0,children:"No video selected"}),Object(n.jsx)(U.a,{title:"Select Video",children:Object(n.jsx)(G.a,{"aria-label":"select video",color:"inherit",className:g.largeButton,onClick:function(e){return x.current.click()},children:Object(n.jsx)(A.a,{})})})]}),Object(n.jsx)("div",{className:"Row",children:Object(n.jsxs)("div",{className:"VideoPlay",children:[Object(n.jsx)(P.a,{url:c.videoFilePath,className:"ReactPlayer",playing:e,width:"840px",height:"100%",controls:!0,onDuration:function(e){o(Object(s.a)(Object(s.a)({},c),{},{duration:e}))},onProgress:function(e){o(Object(s.a)(Object(s.a)({},c),{},{playedSeconds:e.playedSeconds,loadedSeconds:e.loadedSeconds}))},playbackRate:c.playbackRate||1,onPause:d,onStop:d,onStart:l,onPlay:l}),Object(n.jsx)("div",{className:"Row",children:Object(n.jsx)(N,{state:c})})]})})]})};o.a.render(Object(n.jsx)(X,{}),document.getElementById("root"))},57:function(e,t,a){}},[[107,1,2]]]);
//# sourceMappingURL=main.5cbe308d.chunk.js.map