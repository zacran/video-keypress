(this["webpackJsonpvideo-keypress"]=this["webpackJsonpvideo-keypress"]||[]).push([[0],{106:function(e,t,a){"use strict";a.r(t);var n=a(2),i=a(0),c=a(7),o=a.n(c),r=a(24),s=a(11),l=(a(57),a(83),a(5)),d=a(152),u=a(154),j=a(147),b=a(148),v=a(149),h=a(34),g=a(70),p=a(62),O=a(48),m=a(144),f=a(107),y=a(142),x=.1;function k(e){return 1e3*e}function S(e){return"".concat(e.toFixed(2),"ms")}var N=Object(y.a)((function(e){return{root:{flexGrow:1,margin:"auto",maxWidth:"600px"},paper:{padding:e.spacing(1),fontSize:"12px",textAlign:"center",color:e.palette.text.secondary},control:{padding:e.spacing(2)}}})),B=function(e){var t,a=Object(i.useState)([]),c=Object(r.a)(a,2),o=c[0],s=c[1],l=Object(i.useState)([]),d=Object(r.a)(l,2),u=d[0],j=d[1],b=Object(i.useState)(0),v=Object(r.a)(b,2),y=v[0],B=v[1],w=N();return Object(i.useEffect)((function(){var t=setInterval((function(){o.length!==y&&(B(o.length),function(){var t=o.filter((function(e){return"string"===typeof e[0]&&"Meta"!==e[1]}));console.log(o);var a=[];t.forEach((function(e){-1===a.indexOf(e[0])&&a.push(e[0])}));var n=[];a.forEach((function(e){var a=0,i=0,c=t.filter((function(t){return t[0]===e}));console.log("finding derived fields for "+e+" found "+c.length+" events"),a=c.length,c.map((function(e){i+=e[3]-e[2]}));var o={behavior:e,occurences:a,totalDuration:i,avgDuration:i/a};n.push(o)})),j((function(e){return e=n,console.log(e),e})),e.state.derivedFields=u}())}),500);return function(){return clearInterval(t)}})),Object(i.useEffect)((function(){var t=""!==e.state.videoFilePath,a=0===o.length&&e.state.data.events&&0===e.state.data.events.length;if(t&&a){var n=[[{type:"string",id:"Behavior"},{type:"string",id:"Event"},{type:"number",id:"Start"},{type:"number",id:"End"}],["Behavior","Meta",0,k(e.state.data.metadata.duration)]];s(n)}var i=e.state.data.events&&e.state.data.events.length>0,c=e.state.data.events.length+2>o.length;if(i&&c){var r=e.state.data.events[e.state.data.events.length-1];r.end-r.start<x&&(r.end+=x);e.state.data.events.find((function(e){e.id!==r.id&&(e.start===r.start&&(console.warn("Adjusted event start time due to existing similar events: "+r.id),r.start+=.11000000000000001),e.behavior===r.behavior&&e.end===r.start&&(console.warn("Adjusted event start time due to existing similar events: "+r.id),r.start+=.010000000000000002),e.end===r.end&&(console.warn("Adjusted event end time due to existing similar events: "+r.id),r.end+=.11000000000000001))}));var l=[r.behavior,"Event: #"+r.id,k(r.start),k(r.end)];s((function(e){return[].concat(Object(g.a)(e),[l])}))}})),Object(n.jsxs)("div",{className:"Row",children:[u.length>0?u.map((function(e){return Object(n.jsxs)(m.a,{container:!0,className:w.root,spacing:2,children:[Object(n.jsx)(m.a,{item:!0,xs:3,children:Object(n.jsxs)(f.a,{className:w.paper,children:[Object(n.jsx)(O.a,{variant:"caption",display:"inline",gutterBottom:!0,children:"    Behavior:   "}),Object(n.jsx)(O.a,{variant:"subtitle2",display:"block",align:"center",gutterBottom:!0,children:e.behavior})]})}),Object(n.jsx)(m.a,{item:!0,xs:3,children:Object(n.jsxs)(f.a,{className:w.paper,children:[Object(n.jsx)(O.a,{variant:"caption",display:"inline",gutterBottom:!0,children:"    Occurences: "}),Object(n.jsx)(O.a,{variant:"subtitle2",display:"block",align:"center",gutterBottom:!0,children:e.occurences})]})}),Object(n.jsx)(m.a,{item:!0,xs:3,children:Object(n.jsxs)(f.a,{className:w.paper,children:[Object(n.jsx)(O.a,{variant:"caption",display:"inline",gutterBottom:!0,children:"    Avg Duration:   "}),Object(n.jsx)(O.a,{variant:"subtitle2",display:"block",align:"center",gutterBottom:!0,children:S(e.avgDuration)})]})}),Object(n.jsx)(m.a,{item:!0,xs:3,children:Object(n.jsxs)(f.a,{className:w.paper,children:[Object(n.jsx)(O.a,{variant:"caption",display:"inline",gutterBottom:!0,children:"    Total Duration:    "}),Object(n.jsx)(O.a,{variant:"subtitle2",display:"block",align:"center",gutterBottom:!0,children:S(e.totalDuration)})]})})]},e.behavior)})):"",Object(n.jsx)("div",{className:"GoogleChart",children:o.length>1?Object(n.jsx)(p.a,(t={width:"840px",height:"100%",chartType:"Timeline",data:o,options:{timeline:{colorByRowLabel:!0,margin:"auto"}}},Object(h.a)(t,"options",{timeline:{showBarLabels:!1,colorByRowLabel:!0},colors:["transparent","#469FAE","#3ECDB6","#F7D9A6","#F67E5C","#CA1252","#DD5B5C","#D9959A","#938D99","#5E614A"]}),Object(h.a)(t,"rootProps",{"data-testid":"6"}),t)):""})]})},w=a(69),R=a.n(w),F=a(65),E=a.n(F),P=a(52),D={Keybinds:[{key:"g",code:"71",color:{r:"241",g:"112",b:"19",a:"1"},behavior:"Grooming",active:!1},{key:"s",code:"83",color:{r:"41",g:"112",b:"200",a:"1"},behavior:"Scratching",active:!1}]},C=a(53),A=a.n(C),I=a(67),L=a.n(I),T=a(68),z=a.n(T),M=a(150),V=a(155),G=a(151),U=["32"," "],J=Object(y.a)((function(e){return{button:{padding:0},smallButton:{marginTop:-4,padding:4,"& svg":{fontSize:18}},largeButton:{display:"block",margin:"auto","& svg":{fontSize:144,color:"#469FAE"}},toolbar:{minHeight:48,maxHeight:48},title:{flexGrow:1},menu:{width:"fit-content",border:"1px solid ".concat(e.palette.divider),borderRadius:e.shape.borderRadius,"& svg":{margin:e.spacing(1.5)},"& hr":{margin:e.spacing(0,.5)}}}})),K=Object(l.a)({paper:{border:"1px solid #d3d4d5"}})((function(e){return Object(n.jsx)(d.a,Object(s.a)({elevation:0,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},e))})),H=Object(l.a)((function(e){return{root:{"&:focus":{backgroundColor:e.palette.primary.main,"& .MuiListItemIcon-root, & .MuiListItemText-primary":{color:e.palette.common.white}}}}}))(u.a);var W=function(){var e=Object(i.useState)({videoFilePath:"",isPlaying:!1,duration:0,playedSeconds:0,loadedSeconds:0,keybinds:D.Keybinds,data:{metadata:{},events:[]},activeRecords:[],derivedFields:[]}),t=Object(r.a)(e,2),a=t[0],c=t[1];var o=function(e,t){a.keybinds.forEach((function(a){a.key!==String(e)&&a.code!==String(e)||t(a)}))},l=function(e){if(!e.active){e.active=!0,console.log("key down: "+e.key+" at "+a.playedSeconds+" secs");var t={key:e.key,behavior:e.behavior,start:a.playedSeconds},n=a.activeRecords;n.push(t),c(Object(s.a)(Object(s.a)({},a),{},{activeRecords:n})),console.log("recorded activity start: ",t),console.log(a.activeRecords)}},d=function(e){var t=a.activeRecords.find((function(t){return t.key===e.key})),n=a.activeRecords.filter((function(t){return t.key!==e.key}));if(t){e.active=!1,console.log("key up: "+e.key+" at "+a.playedSeconds+" secs"),t.id=a.data.events.length,t.end=a.playedSeconds,console.log("recorded activity end: ",t),console.log(a.activeRecords);var i=a.data.events;i.push(t),c(Object(s.a)(Object(s.a)({},a),{},{activeRecords:n,data:{events:i,metadata:Object(s.a)({},a.data.metadata)}})),console.log(a.data)}};Object(P.a)("keydown",(function(e){""!==a.videoFilePath&&U.includes(String(e.key))&&(e.preventDefault(),c(Object(s.a)(Object(s.a)({},a),{},{isPlaying:!a.isPlaying}))),a.isPlaying&&o(e.key,l)})),Object(P.a)("keyup",(function(e){var t=e.key;o(t,d)}));var u=J(),h=Object(i.useRef)(null),g=(Object(i.useRef)(null),Object(i.useState)(null)),p=Object(r.a)(g,2),f=p[0],y=p[1];return Object(n.jsxs)("div",{className:"App",children:[Object(n.jsx)("input",{type:"file",ref:h,onChange:function(e){var t=e.target.files[0];if(t){var n=document.createElement("video"),i=URL.createObjectURL(t);n.src=i,n.addEventListener("loadedmetadata",(function(){var t=parseFloat(n.duration.toFixed(2));c(Object(s.a)(Object(s.a)({},a),{},{videoFilePath:i,videoFileName:e.target.files[0].name,data:{metadata:{fileName:e.target.files[0].name,scoringDate:Date.now(),scoringDateText:(new Date).toISOString(),duration:t},events:[]}})),document.activeElement.blur()}))}},style:{display:"none"}}),Object(n.jsxs)(K,{anchorEl:f,keepMounted:!0,open:Boolean(f),onClose:function(){y(null)},children:[Object(n.jsxs)(H,{children:[!1===a.isPlaying&&0===a.playedSeconds&&Object(n.jsx)(j.a,{primary:"Start",secondary:"space",align:"center"}),!0===a.isPlaying&&Object(n.jsx)(j.a,{primary:"Pause",secondary:"space",align:"center"}),!1===a.isPlaying&&a.playedSeconds>0&&Object(n.jsx)(j.a,{primary:"Resume",secondary:"space",align:"center"})]}),a.keybinds.map((function(e){return Object(n.jsx)(H,{children:Object(n.jsx)(j.a,{primary:e.behavior,secondary:e.key,align:"center"})},e.key)}))]}),Object(n.jsx)(b.a,{position:"static",style:{background:"#469FAE"},children:Object(n.jsxs)(v.a,{className:u.toolbar,children:[Object(n.jsx)(O.a,{variant:"h5",component:"h1",className:u.title,children:"Behavior Recorder"}),Object(n.jsxs)(m.a,{container:!0,alignItems:"center",className:u.menu,children:[Object(n.jsx)(V.a,{title:"Select Video",children:Object(n.jsx)(M.a,{"aria-label":"select video",color:"inherit",className:u.button,onClick:function(e){return h.current.click()},children:Object(n.jsx)(A.a,{})})}),Object(n.jsx)(G.a,{orientation:"vertical",flexItem:!0}),Object(n.jsx)(V.a,{title:"Download Data",children:Object(n.jsx)(M.a,{"aria-label":"download data",color:"inherit",className:u.button,onClick:function(){var e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(a.data)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",a.videoFileName+"-scored-behavior.json"),document.body.appendChild(t),t.click(),t.remove()},children:Object(n.jsx)(L.a,{})})}),Object(n.jsx)(G.a,{orientation:"vertical",flexItem:!0}),Object(n.jsx)(V.a,{title:"Keybinds",children:Object(n.jsx)(M.a,{"aria-label":"keybinds",color:"inherit","aria-haspopup":"true",onClick:function(e){y(e.currentTarget)},className:u.button,children:Object(n.jsx)(z.a,{})})})]})]})}),a.videoFilePath?Object(n.jsxs)(O.a,{variant:"button",display:"block",align:"center",gutterBottom:!0,children:["Current Video: ",a.videoFileName,Object(n.jsx)(V.a,{title:"Unset Video",children:Object(n.jsx)(M.a,{"aria-label":"unset video",color:"inherit",className:u.smallButton,onClick:function(){h.current.value="",c(Object(s.a)(Object(s.a)({},a),{},{videoFilePath:"",videoFileName:""}))},children:Object(n.jsx)(R.a,{})})})]}):"",a.videoFilePath?"":Object(n.jsxs)("div",{children:[Object(n.jsx)(O.a,{variant:"button",display:"block",align:"center",gutterBottom:!0,children:"No video selected"}),Object(n.jsx)(V.a,{title:"Select Video",children:Object(n.jsx)(M.a,{"aria-label":"select video",color:"inherit",className:u.largeButton,onClick:function(e){return h.current.click()},children:Object(n.jsx)(A.a,{})})})]}),Object(n.jsx)("div",{className:"Row",children:Object(n.jsxs)("div",{className:"VideoPlay",children:[Object(n.jsx)(E.a,{url:a.videoFilePath,className:"ReactPlayer",playing:a.isPlaying,width:"840px",height:"100%",controls:!0,onDuration:function(e){c(Object(s.a)(Object(s.a)({},a),{},{duration:e}))},onProgress:function(e){c(Object(s.a)(Object(s.a)({},a),{},{playedSeconds:e.playedSeconds,loadedSeconds:e.loadedSeconds}))}}),Object(n.jsx)("div",{className:"Row",children:Object(n.jsx)(B,{state:a})})]})})]})};o.a.render(Object(n.jsx)(W,{}),document.getElementById("root"))},57:function(e,t,a){}},[[106,1,2]]]);
//# sourceMappingURL=main.c0b4f4bf.chunk.js.map