(this["webpackJsonpvideo-keypress"]=this["webpackJsonpvideo-keypress"]||[]).push([[0],{108:function(e,t,a){"use strict";a.r(t);var n=a(2),i=a(0),o=a(8),c=a.n(o),r=a(26),s=a(12),l=(a(56),a(85),a(5)),d=a(154),b=a(156),u=a(149),j=a(150),h=a(151),v=a(72),p=a(61),m=a(47),g=a(146),x=a(109),O={Keybinds:[{key:"1",code:"49",order:1,color:{r:"241",g:"112",b:"19",a:"1"},behavior:"Behavior1",active:!1},{key:"2",code:"50",order:2,color:{r:"41",g:"112",b:"200",a:"1"},behavior:"Behavior2",active:!1},{key:"3",code:"51",order:3,color:{r:"41",g:"112",b:"200",a:"1"},behavior:"Behavior3",active:!1}]},y=a(144),f=.1;function k(e){return 1e3*e}function N(e){var t=e.toFixed(2);return isNaN(t)&&(t=0),"".concat(e.toFixed(2),"ms")}var w=Object(y.a)((function(e){return{root:{flexGrow:1,margin:"auto",maxWidth:"600px"},paper:{padding:e.spacing(1),fontSize:"12px",textAlign:"center",color:e.palette.text.secondary},control:{padding:e.spacing(2)}}})),S=function(e){var t=Object(i.useState)([]),a=Object(r.a)(t,2),o=a[0],c=a[1],s=Object(i.useState)([]),l=Object(r.a)(s,2),d=l[0],b=l[1],u=Object(i.useState)(0),j=Object(r.a)(u,2),h=j[0],y=j[1],S=w();return Object(i.useEffect)((function(){var t=setInterval((function(){o.length!==h&&(y(o.length),function(){var t=o.filter((function(e){return"string"===typeof e[0]&&"Meta"!==e[1]}));console.log(o);var a=[];t.forEach((function(e){-1===a.indexOf(e[0])&&a.push(e[0])}));var n=[],i=O.Keybinds;a.forEach((function(e){var a=0,o=0,c=t.filter((function(t){return t[0]===e})),r=i.filter((function(t){return t.behavior===e})).order;console.log("finding derived fields for "+e+" found "+c.length+" events"),a=c.length-1,c.forEach((function(e){o+=e[3]-e[2]}));var s=o/a;0===a&&(s=0);var l={order:r,behavior:e,occurences:a,totalDuration:o,avgDuration:s};n.push(l)})),n.sort((function(e,t){return e.order>t.order?1:-1})),b((function(e){return e=n,console.log(e),e})),e.state.derivedFields=d}())}),500);return function(){return clearInterval(t)}})),Object(i.useEffect)((function(){var t=""!==e.state.videoFilePath,a=0===o.length&&e.state.data.events&&0===e.state.data.events.length;if(t||0===o.length||(c([]),b([])),t&&a){var n=[[{type:"string",id:"Behavior"},{type:"string",id:"Event"},{type:"number",id:"Start"},{type:"number",id:"End"}],["Behavior","Meta",0,k(e.state.data.metadata.duration)]];e.state.keybinds.forEach((function(e){n.push([e.behavior,"",0,0])})),c(n)}var i=e.state.data.events&&e.state.data.events.length>0,r=e.state.data.events.length+2>o.length;if(i&&r){var s=e.state.data.events[e.state.data.events.length-1];s.end-s.start<f&&(s.end+=f),e.state.data.events.forEach((function(e){e.id!==s.id&&(e.start===s.start&&(console.warn("Adjusted event start time due to existing similar events: "+s.id),s.start+=.11000000000000001),e.behavior===s.behavior&&e.end===s.start&&(console.warn("Adjusted event start time due to existing similar events: "+s.id),s.start+=.010000000000000002),e.end===s.end&&(console.warn("Adjusted event end time due to existing similar events: "+s.id),s.end+=.11000000000000001))}));var l=[s.behavior,"Event: #"+s.id,k(s.start),k(s.end)];c((function(e){return[].concat(Object(v.a)(e),[l])}))}})),Object(n.jsxs)("div",{className:"Row",children:[d.length>0?d.map((function(e){return Object(n.jsxs)(g.a,{container:!0,className:S.root,spacing:2,children:[Object(n.jsx)(g.a,{item:!0,xs:3,children:Object(n.jsxs)(x.a,{className:S.paper,children:[Object(n.jsx)(m.a,{variant:"caption",display:"inline",gutterBottom:!0,children:"    Behavior:   "}),Object(n.jsx)(m.a,{variant:"subtitle2",display:"block",align:"center",gutterBottom:!0,children:e.behavior})]})}),Object(n.jsx)(g.a,{item:!0,xs:3,children:Object(n.jsxs)(x.a,{className:S.paper,children:[Object(n.jsx)(m.a,{variant:"caption",display:"inline",gutterBottom:!0,children:"    Occurences: "}),Object(n.jsx)(m.a,{variant:"subtitle2",display:"block",align:"center",gutterBottom:!0,children:e.occurences})]})}),Object(n.jsx)(g.a,{item:!0,xs:3,children:Object(n.jsxs)(x.a,{className:S.paper,children:[Object(n.jsx)(m.a,{variant:"caption",display:"inline",gutterBottom:!0,children:"    Avg Duration:   "}),Object(n.jsx)(m.a,{variant:"subtitle2",display:"block",align:"center",gutterBottom:!0,children:N(e.avgDuration)})]})}),Object(n.jsx)(g.a,{item:!0,xs:3,children:Object(n.jsxs)(x.a,{className:S.paper,children:[Object(n.jsx)(m.a,{variant:"caption",display:"inline",gutterBottom:!0,children:"    Total Duration:    "}),Object(n.jsx)(m.a,{variant:"subtitle2",display:"block",align:"center",gutterBottom:!0,children:N(e.totalDuration)})]})})]},e.behavior)})):"",Object(n.jsx)("div",{id:"chart-container",className:"GoogleChart",children:o.length>1?Object(n.jsx)(p.a,{width:"840px",height:"400px",chartType:"Timeline",data:o,options:{timeline:{colorByRowLabel:!0,margin:"auto",showBarLabels:!1},colors:["transparent","#469FAE","#3ECDB6","#C09BD8","#F67E5C","#CA1252","#DD5B5C","#D9959A","#938D99","#5E614A"]},rootProps:{"data-testid":"6"}}):""})]})},B=a(70),R=a.n(B),E=a(64),P=a.n(E),C=a(51),F=a(67),D=a.n(F),A=a(71),I=a.n(A),T=a(52),L=a.n(T),M=a(66),V=a.n(M),U=a(68),G=a.n(U),z=a(69),H=a.n(z),K=a(152),J=a(158),W=a(153),_=a(157),q=["32"," "],Q=Object(y.a)((function(e){return{content:{marginTop:"55px"},reactPlayer:{margin:"auto"},popoverMenu:{width:"200px"},slider:{margin:"0px 20px",width:"80%"},button:{padding:0},smallButton:{marginTop:-4,padding:4,"& svg":{fontSize:18}},largeButton:{display:"block",margin:"auto","& svg":{fontSize:144,color:"#469FAE"}},toolbar:{minHeight:48,maxHeight:48},title:{flexGrow:1},bottomAppBar:{top:"auto",bottom:0},bottomToolbar:{margin:"auto",minWidth:"700px",textAlign:"center",minHeight:32,maxHeight:32},menu:{width:"fit-content",border:"1px solid ".concat(e.palette.divider),borderRadius:e.shape.borderRadius,"& svg":{margin:e.spacing(1.5)},"& hr":{margin:e.spacing(0,.5)}}}})),X=Object(l.a)({paper:{border:"1px solid #d3d4d5",width:"200px",margin:"0px 10px"}})((function(e){return Object(n.jsx)(d.a,Object(s.a)({elevation:0,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"right"}},e))})),Y=Object(l.a)((function(e){return{root:{"&:focus":{backgroundColor:e.palette.primary.main,"& .MuiListItemIcon-root, & .MuiListItemText-primary":{color:e.palette.common.white}}}}}))(b.a),Z=function(){var e=!1,t=Object(i.useState)({videoFilePath:"",isPlaying:!1,duration:0,playedSeconds:0,loadedSeconds:0,playbackRate:1,keybinds:O.Keybinds,data:{metadata:{},events:[]},activeRecords:[],derivedFields:[]}),a=Object(r.a)(t,2),o=a[0],c=a[1],l=function(){return window.confirm("Are you sure you wish to reset the existing video? Unsaved data will be lost.")},d=function(){N.current.value="",c(Object(s.a)(Object(s.a)({},o),{},{videoFilePath:"",videoFileName:"",data:{metadata:{},events:[]}}))};var b=function(e){(""===o.videoFilePath||l())&&(d(),N.current.click())},v=function(){c(Object(s.a)(Object(s.a)({},o),{},{isPlaying:!0}))},p=function(){c(Object(s.a)(Object(s.a)({},o),{},{isPlaying:!1}))},x=function(e,t){console.log("press "+e,o),o.keybinds.forEach((function(a){a.key!==String(e)&&a.code!==String(e)||t(a)}))},y=function(e){if(!e.active){e.active=!0,console.log("key down: "+e.key+" at "+o.playedSeconds+" secs");var t={key:e.key,behavior:e.behavior,start:o.playedSeconds},a=o.activeRecords;a.push(t),c(Object(s.a)(Object(s.a)({},o),{},{activeRecords:a})),console.log("recorded activity start: ",t),console.log(o.activeRecords)}},f=function(e){var t=o.activeRecords.find((function(t){return t.key===e.key})),a=o.activeRecords.filter((function(t){return t.key!==e.key}));if(t){e.active=!1,console.log("key up: "+e.key+" at "+o.playedSeconds+" secs"),t.id=o.data.events.length,t.end=o.playedSeconds,console.log("recorded activity end: ",t),console.log(o.activeRecords);var n=o.data.events;n.push(t),c(Object(s.a)(Object(s.a)({},o),{},{activeRecords:a,data:{events:n,metadata:Object(s.a)({},o.data.metadata)}})),console.log(o.data)}};Object(C.a)("keydown",(function(t){""!==o.videoFilePath&&q.includes(String(t.key))?(console.log("space "+t.key,o),t.preventDefault(),e=!e):o.isPlaying&&x(t.key,y)})),Object(C.a)("keyup",(function(e){var t=e.key;x(t,f)}));var k=Q(),N=Object(i.useRef)(null),w=Object(i.useState)(null),B=Object(r.a)(w,2),E=B[0],F=B[1],A=Object(i.useState)(null),T=Object(r.a)(A,2),M=T[0],U=T[1];return Object(n.jsxs)("div",{className:"App",children:[Object(n.jsx)("input",{type:"file",ref:N,onChange:function(e){var t=e.target.files[0];if(t){var a=document.createElement("video"),n=URL.createObjectURL(t);a.src=n,a.addEventListener("loadedmetadata",(function(){var t=parseFloat(a.duration.toFixed(2));c(Object(s.a)(Object(s.a)({},o),{},{videoFilePath:n,videoFileName:e.target.files[0].name,data:{metadata:{fileName:e.target.files[0].name,scoringDate:Date.now(),scoringDateText:(new Date).toISOString(),duration:t},events:[]}})),document.activeElement.blur()}))}},style:{display:"none"}}),Object(n.jsxs)(X,{className:k.popoverMenu,anchorEl:M,keepMounted:!0,open:Boolean(M),onClose:function(){U(null)},children:[Object(n.jsx)(u.a,{id:"playbackRate-slider",primary:"Playback Speed",align:"center"}),Object(n.jsx)(_.a,{className:k.slider,value:o.playbackRate||1,getAriaValueText:function(e){return"".concat(e,"x")},"aria-labelledby":"playbackRate-slider",step:.25,marks:!0,min:.25,max:2,valueLabelDisplay:"auto",onChange:function(e,t){t!==o.playbackRate&&c(Object(s.a)(Object(s.a)({},o),{},{playbackRate:parseFloat(t)}))}},"playbackRate-slider")]}),Object(n.jsxs)(X,{className:k.popoverMenu,anchorEl:E,keepMounted:!0,open:Boolean(E),onClose:function(){F(null)},children:[Object(n.jsxs)(Y,{children:[!1===o.isPlaying&&0===o.playedSeconds&&Object(n.jsx)(u.a,{primary:"Start",secondary:"space",align:"center"}),!0===o.isPlaying&&Object(n.jsx)(u.a,{primary:"Pause",secondary:"space",align:"center"}),!1===o.isPlaying&&o.playedSeconds>0&&Object(n.jsx)(u.a,{primary:"Resume",secondary:"space",align:"center"})]}),o.keybinds.map((function(e){return Object(n.jsx)(Y,{children:Object(n.jsx)(u.a,{primary:e.behavior,secondary:e.key,align:"center"})},e.key)}))]}),Object(n.jsx)(j.a,{position:"fixed",style:{background:"#469FAE"},children:Object(n.jsxs)(h.a,{className:k.toolbar,children:[Object(n.jsx)(m.a,{variant:"h5",component:"h1",className:k.title,children:"Video Keypress"}),Object(n.jsxs)(g.a,{container:!0,alignItems:"center",className:k.menu,children:[Object(n.jsx)(J.a,{title:"Select Video",children:Object(n.jsx)(K.a,{"aria-label":"select video",color:"inherit",className:k.button,onClick:function(e){return b()},children:Object(n.jsx)(L.a,{})})}),Object(n.jsx)(W.a,{orientation:"vertical",flexItem:!0}),Object(n.jsx)(J.a,{title:"Download Data",children:Object(n.jsx)(K.a,{"aria-label":"download data",color:"inherit",className:k.button,onClick:function(){if(o.data.events&&o.data.events.length>0){var e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(o.data)),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download",o.videoFileName+"-scored-behavior.json"),document.body.appendChild(t),t.click(),t.remove()}},children:Object(n.jsx)(V.a,{})})}),Object(n.jsx)(W.a,{orientation:"vertical",flexItem:!0}),Object(n.jsx)(J.a,{title:"Download SVG",children:Object(n.jsx)(K.a,{"aria-label":"download svg",color:"inherit",className:k.button,onClick:function(){var e=document.getElementById("chart-container").getElementsByTagName("svg")[0].outerHTML;e=e.replace("<svg",'<svg xmlns="http://www.w3.org/2000/svg"');var t=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download=o.videoFileName+"-scored-behavior.svg",document.body.appendChild(n),n.click(),document.body.removeChild(n)},children:Object(n.jsx)(D.a,{})})}),Object(n.jsx)(W.a,{orientation:"vertical",flexItem:!0}),Object(n.jsx)(J.a,{title:"Keybinds",children:Object(n.jsx)(K.a,{"aria-label":"keybinds",color:"inherit","aria-haspopup":"true",onClick:function(e){F(e.currentTarget)},className:k.button,children:Object(n.jsx)(G.a,{})})}),Object(n.jsx)(W.a,{orientation:"vertical",flexItem:!0}),Object(n.jsx)(J.a,{title:"Settings",children:Object(n.jsx)(K.a,{"aria-label":"settings",color:"inherit","aria-haspopup":"true",onClick:function(e){U(e.currentTarget)},className:k.button,children:Object(n.jsx)(H.a,{})})})]})]})}),Object(n.jsxs)("div",{className:k.content,children:[o.videoFilePath?Object(n.jsxs)(m.a,{variant:"button",display:"block",align:"center",gutterBottom:!0,children:["Current Video: ",o.videoFileName,Object(n.jsx)(J.a,{title:"Unset Video",children:Object(n.jsx)(K.a,{"aria-label":"unset video",color:"inherit",className:k.smallButton,onClick:function(){l()&&d()},children:Object(n.jsx)(R.a,{})})})]}):"",o.videoFilePath?"":Object(n.jsxs)("div",{children:[Object(n.jsx)(m.a,{variant:"button",display:"block",align:"center",gutterBottom:!0,children:"No video selected"}),Object(n.jsx)(J.a,{title:"Select Video",children:Object(n.jsx)(K.a,{"aria-label":"select video",color:"inherit",className:k.largeButton,onClick:function(e){return b()},children:Object(n.jsx)(L.a,{})})})]}),Object(n.jsx)("div",{className:"Row",children:Object(n.jsxs)("div",{className:"VideoPlay",children:[Object(n.jsx)(P.a,{url:o.videoFilePath,className:k.reactPlayer,playing:e,width:"840px",height:"100%",controls:!0,onDuration:function(e){c(Object(s.a)(Object(s.a)({},o),{},{duration:e}))},onProgress:function(e){c(Object(s.a)(Object(s.a)({},o),{},{playedSeconds:e.playedSeconds,loadedSeconds:e.loadedSeconds}))},playbackRate:o.playbackRate||1,onPause:p,onStop:p,onStart:v,onPlay:v}),Object(n.jsx)("div",{className:"Row",children:Object(n.jsx)(S,{state:o})})]})})]}),Object(n.jsx)(j.a,{position:"fixed",color:"transparent",className:k.bottomAppBar,children:Object(n.jsx)(h.a,{className:k.bottomToolbar,children:Object(n.jsxs)(g.a,{container:!0,alignItems:"center",spacing:2,children:[Object(n.jsx)(g.a,{item:!0,xs:6,children:Object(n.jsx)(m.a,{variant:"caption",align:"center",gutterBottom:!0,children:"No data is transfered. All data remains in your browser."})}),Object(n.jsx)(g.a,{item:!0,xs:1,children:Object(n.jsx)(J.a,{title:"Visit GitHub Repo",children:Object(n.jsx)(K.a,{"aria-label":"visit github repo",color:"inherit",className:k.button,onClick:function(){window.open("https://github.com/zacran/video-keypress","_blank")},children:Object(n.jsx)(I.a,{})})})}),Object(n.jsx)(g.a,{item:!0,xs:3,children:Object(n.jsx)(m.a,{variant:"caption",align:"center",gutterBottom:!0,children:"GNU General Public License"})})]})})})]})};c.a.render(Object(n.jsx)(Z,{}),document.getElementById("root"))},56:function(e,t,a){}},[[108,1,2]]]);
//# sourceMappingURL=main.11091d37.chunk.js.map